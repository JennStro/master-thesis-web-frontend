<!DOCTYPE html>
<html lang="en">
<head>
  <title>Master thesis web</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <h1>Master thesis web</h1>
  <div id="app"></div>
  <script src="main.js"></script>
    <textarea rows="10" cols="100" id="codeInput"></textarea><br>
    <button type="button" id="buttonInput">Find bugs!</button>
    <p id="positionText"></p> <br>
    <p id="explanationText"></p> <br>
    <p id="suggestionText"></p> <br>
</body>
<script>
  async function postInputData() {
    const data = document.getElementById('codeInput').value;
    await fetch('https://master-thesis-web-backend-prod.herokuapp.com/analyse', {
      method: 'POST',
      headers: {
        'Content-Type': 'raw',
        'cache-control': 'no-cache',
        'pragma': 'no-cache',
      },
      body: data,
    }).then(
            res => res.json()
    ).then( json =>
    {
      console.log(json);
      const obj = JSON.parse(JSON.stringify(json));
      console.log(obj.containingClass);
      console.log(obj);

      if (obj.status === "errors") {
        let positionString = "In class " + obj.containingClass;
        let explanationString = obj.explanation;
        let suggestionString = obj.suggestion;
        if (obj.lineNumber !== -1) {
          positionString += ", on line number " + obj.lineNumber;
        }
        document.getElementById("positionText").textContent = positionString;
        document.getElementById("explanationText").textContent = explanationString;
        document.getElementById("suggestionText").textContent = suggestionString;
      } else {
        document.getElementById("positionText").textContent = "Found no errors!";
        document.getElementById("explanationText").textContent = "";
        document.getElementById("suggestionText").textContent = "";

      }
    }
    );
  }
  document.getElementById('buttonInput').addEventListener('click', postInputData, false);
</script>
</html>
